<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>PIMS FAQ ì±—ë´‡</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 16px;
      background: #f7f7f7;
    }
    #chat {
      max-width: 1500px;
      margin: 0 auto;
    }
    .msg {
      padding: 10px 12px;
      margin-bottom: 8px;
      border-radius: 8px;
      white-space: pre-wrap;
      font-size: 14px;
    }
    .user {
      background: #d0e8ff;
      text-align: right;
    }
    .bot {
      background: #ffffff;
      border: 1px solid #ddd;
    }
    #input-area {
      max-width: 1500px;
      margin: 12px auto 0;
      display: flex;
      gap: 8px;
    }
    #question {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      background: #111;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
    }
  </style>
</head>
<body>
  <div id="chat">
    <div class="msg bot">
      ì•ˆë…•í•˜ì„¸ìš” ğŸ™Œ<br />
      ì—¬ê¸°ëŠ” <b>PIMS FAQ ì „ìš© ì±—ë´‡</b>ì´ì—ìš”.<br />
      ê¶ê¸ˆí•œ ë‚´ìš©ì„ ì•„ë˜ì— ììœ ë¡­ê²Œ ì…ë ¥í•´ ì£¼ì„¸ìš”!<br /><br />
      
      ì¶”ê°€í•˜ê³ ì í•˜ëŠ” ì§ˆë¬¸ì€ [ğŸ—³ï¸FAQ ì§ˆë¬¸ ì œì•ˆí•˜ê¸°ì— ë‚¨ê²¨ì£¼ì‹œë©´ ê²€í†  í›„ ë°˜ì˜í• ê²Œìš”.<br />
    </div>
  </div>

  <div id="input-area">
    <input id="question" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." />
    <button id="sendBtn">ì „ì†¡</button>
  </div>

  <script>
    // ğŸ‘‰ ì—¬ê¸°ë§Œ ë³¸ì¸ Worker ì£¼ì†Œë¡œ ë°”ê¾¸ë©´ ë¨
    // ì˜ˆì‹œ: "https://pims-faq-bot.paperwithu.workers.dev/api/faq-chat"
    const API_ENDPOINT = "https://pims-faq-bot.paperwithu.workers.dev/api/faq-chat";

    const chatEl = document.getElementById("chat");
    const inputEl = document.getElementById("question");
    const sendBtn = document.getElementById("sendBtn");

    function addMsg(text, type) {
      const div = document.createElement("div");
      div.className = "msg " + type;
      div.textContent = text;
      chatEl.appendChild(div);
      window.scrollTo(0, document.body.scrollHeight);
    }

    async function send() {
      const q = inputEl.value.trim();
      if (!q) return;

      // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
      addMsg(q, "user");
      inputEl.value = "";
      inputEl.focus();
      sendBtn.disabled = true;

      try {
        const res = await fetch(API_ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ question: q }),
        });

        const data = await res.json();
        console.log("DEBUG data:", data); // ë””ë²„ê·¸ìš© ì½˜ì†” ì¶œë ¥

        if (data.answer) {
          // ì •ìƒ ì‘ë‹µ
          addMsg(data.answer, "bot");
        } else if (data.error) {
          // ì—ëŸ¬ ì‘ë‹µ
          const msg = data.detail
            ? `ì˜¤ë¥˜: ${data.error}\n${data.detail}`
            : `ì˜¤ë¥˜: ${data.error}`;
          addMsg(msg, "bot");
        } else {
          // ì˜ˆìƒì¹˜ ëª»í•œ ì‘ë‹µ í˜•ì‹
          addMsg("ì„œë²„ì—ì„œ ìœ íš¨í•œ ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.", "bot");
        }
      } catch (e) {
        console.error(e);
        addMsg("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.", "bot");
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener("click", send);
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") send();
    });
  </script>
</body>
</html>



